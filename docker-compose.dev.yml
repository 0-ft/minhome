services:
  # Override server: mount source for hot-reload instead of building an image
  server:
    image: node:22-slim
    build: !reset null
    command: sh -c "corepack enable && pnpm --filter @minhome/server dev"
    working_dir: /app
    volumes:
      - .:/app

  # Add frontend dev server (not in production compose)
  frontend:
    container_name: minhome-frontend
    image: node:22-slim
    working_dir: /app
    command: sh -c "corepack enable && cd frontend && npx vite --host"
    volumes:
      - .:/app
    ports:
      - 5173:5173
    environment:
      - VITE_API_TARGET=http://server:3111
    depends_on:
      - server
